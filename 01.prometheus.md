# Prometheus

### install

1. install prometheus

   https://prometheus.io/download/

2. install exporters

   * node_exporter
   * apache_exporter  : https://github.com/Lusitaniae/apache_exporter

3. Grafana
   https://grafana.com/docs/grafana/latest/installation/debian/



#### 1. Download

```sh
$ wget https://github.com/prometheus/prometheus/releases/download/v2.33.4/prometheus-2.33.4.linux-amd64.tar.gz
$ wget https://github.com/prometheus/node_exporter/releases/download/v1.3.1/node_exporter-1.3.1.linux-amd64.tar.gz
$ gunzip *.gz
$ tar xvf node_exporter-1.3.1.linux-amd64.tar
$ tar xvf prometheus-2.33.4.linux-amd64.tar
```

#### 2. 설치

```sh
$ sudo mkdir -p /usr/local/prometheus
$ sudo mv console_libraries/ consoles/ prometheus /usr/local/prometheus/
$ sudo mv prometheus.yml /usr/local/prometheus/

$ sudo groupadd --system prometheus
$ sudo useradd --system -s /usr/sbin/nologin -g prometheus prometheus

$ sudo  chown -R  prometheus:prometheus /usr/local/prometheus
# mkdir  -p /var/lib/prometheus/
# chown  prometheus:prometheus /var/lib/prometheus/
```



#### 3. 설정

##### prometheus 

```sh
cat /etc/systemd/system/prometheus.service 
[Unit]
Description=Prometheus
Wants=network-online.target
After=network-online.target

[Service]
User=prometheus
Restart=on-failure
ExecStart=/usr/local/prometheus/prometheus \
	--config.file=/usr/local/prometheus/prometheus.yml \
	--storage.tsdb.path=/var/lib/prometheus/ \
	--web.console.templates=/usr/prometheus/console \
	--web.console.libraries=/usr/prometheus/console_libraries \
	--web.listen-address=0.0.0.0:9090 \
	--web.external-url=

[Install]
WantedBy=multi-user.target

$ systemctl daemon-reload
$ systemctl start prometheus
$ journalctl -xe
```

확인:  http://localhost:9090



##### node exporter

```
# mkdir -p  /usr/local/prometheus/exporters
# chown -R prometheus:prometheus /usr/local/prometheus/exporters/
$ sudo mv node_exporter  /usr/local/prometheus/exporters/
```

```sh
# cat  node_exporter.service 
[Unit]
Description=Prometheus - node_exporter
Wants=network-online.target
After=network-online.target

[Service]
User=prometheus
Restart=on-failure
ExecStart=/usr/local/prometheus/exporters/node_exporter 

[Install]
WantedBy=multi-user.target

# systemctl daemon-reload
# systemctl start node_exporter.service 
# systemctl status  node_exporter.service
$ journalctl -xe
```


# Ubuntu Set up

## xrdp

### install 

```
$ sudo apt install ubuntu-desktop
$ sudo adduser xrdp ssl-cert
$ sudo ufw allow from 192.168.2.0/24 to any port 3389
$ sudo ufw reload
$ sudo ufw status
```

#### ubuntu 20 xrdp 색상관리자 인증 메세지

/etc/polkit-1/localauthority/50-local.d 
디렉터리로 가서 (없으면 생성)

45-allow-colord.pkla 라는 파일을 만들고,

```
[Allow Colord all Users]
Identity=unix-user:*
Action=org.freedesktop.color-manager.create-device;org.freedesktop.color-manager.create-profile;org.freedesktop.color-manager.delete-device;org.freedesktop.color-manager.delete-profile;org.freedesktop.color-manager.modify-device;org.freedesktop.color-manager.modify-profile
ResultAny=no
ResultInactive=no
ResultActive=yes

[Allow Package Management all Users]
Identity=unix-user:*
Action=org.debian.apt.*;io.snapcraft.*;org.freedesktop.packagekit.*;com.ubuntu.update-notifier.*
ResultAny=no
ResultInactive=no
ResultActive=yes
```



#### xrdp와 share  설정

* xrdp 잘 안되면 share 설정하라고 하는데... 설정안해도 잘된다.

![image-20220821120158608](D:\Code\dev\ubuntu\img\image-20220821120158608.png)



#### ubuntu 22 xrdp 재설치

##### 1. remove xrdp

```sh
$ sudo systemctl disable xrdp
$ sudo systemctl stop xrdp

$ sudo apt purge xrdp
$ sudo apt purge xserver-xorg-core
$ sudo apt purge xserver-xorg-input-all
$ sudo apt purge xorgxrdp
```



##### 2. reinstall

```sh
$ sudo apt install xrdp
$ sudo apt install xserver-xorg-core
$ sudo apt install xserver-xorg-input-all
$ sudo apt install xorgxrdp
```

You also need to grant access to the **/etc/ssl/private/ssl-cert-snakeoil.key** file for **xrdp** user. It is available to members of the **ssl-cert** group by default.

```sh
$ sudo adduser xrdp ssl-cert           # add xrdp into ssl-cert group
$ sudo systemctl start xrdp            # start xrdp service
$ systemctl is-active xrdp             # check xrdp state
...
active
$ sudo systemctl enable xrdp           # start xrdp on system start
$ sudo ufw allow 3389
$ sudo ufw allow from 10.5.5.0/24 to any port 3389
```



##### 3. 주의 사항 

* xrpd 접속하는 GUI 계정은 별도로 유지하면 아무런 문제가 없다. 

* 동일 한 유저로 콘솔에서 GUI로 로그인하고 xrdp로 로그인하면  한쪽이 멈춰 버린다.
* 이때는 `$ sudo  systemctl restart gdm` 해서 다시 시작한다. 





#### Ubuntu GUI restart

##### 1. gnome-shell

In this scenario we simply restart the `gnome-shell` as non-privileged user by entering the following command in terminal.

```sh
$ gnome-shell --replace
```

##### 2. systemd-logind 

```sh
$ sudo systemctl restart  systemd-logind
```

##### 3. restart Display Manager 

```sh
$ sudo  systemctl restart gdm
```



#### GUI에 root 로그인 하기

##### 1.  root passwd 설정

##### 2.  GDM configureation file

```sh
$ sudo nano /etc/gdm3/custom.conf

AllowRoot=true
```

##### 3. PAM authentication daemon configuration file

* 주석처리 

```sh
$ sudo nano /etc/pam.d/gdm-password

# auth   required        pam_succeed_if.so user != root quiet_success
```



$ sudo nano /etc/gdm3/custom.conf





## user 

#### group add

```
$ sudo groupadd foo
$ sudo groupadd bar
$ cat /etc/group
```

```
# id 명령으로 현재 설정된 id 정보나 group 정보를 알 수 있다.
$ sudo id leocat
uid=1000(leocat) gid=1000(leocat) groups=1000(leocat)

# -G 옵션으로 secondary group으로 foo 설정
$ sudo usermod -G foo leocat
$ sudo id leocat
uid=1000(leocat) gid=1000(leocat) groups=1000(leocat),10000(foo)

# -a 옵션으로 secondary group을 추가할 수 있다. (append)
$ sudo usermod -G foo -a leocat
$ sudo id leocat
uid=1000(leocat) gid=1000(leocat) groups=1000(leocat),10000(foo),10001(bar)

# 콤마(,)를 이용해서 여러 group을 지정할 수 있다.
$ sudo usermod -G foo,bar leocat
$ sudo id leocat
uid=1000(leocat) gid=1000(leocat) groups=1000(leocat),10000(foo),10001(bar)

# group을 제거하면 user에 추가되어 있던 group도 제거된다.
$ sudo groupdel bar
[leocat@my-test ~]$ sudo id leocat
uid=1000(leocat) gid=1000(leocat) groups=1000(leocat),10000(foo)
```



### 환경 설정

#### super key가 제일 중요

* super key는 윈도우키가 동작하는데 xrdp 같은 경우는 아쉬운데로 검색 기능만 별로 키로 지정하여 사용한다.

![image-20220821115953924](D:\Code\dev\ubuntu\img\image-20220821115953924.png)



## Typora 

### install

```
# or use
# wget -qO - https://typora.io/linux/public-key.asc | sudo apt-key add -
wget -qO - https://typoraio.cn/linux/public-key.asc | sudo tee /etc/apt/trusted.gpg.d/typora.asc

# add Typora's repository
sudo add-apt-repository 'deb https://typora.io/linux ./'
sudo apt-get update

# install typora
sudo apt-get install typora
```

